<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="Date-Revision-yyyymmdd" content="20140918"/>
  <meta http-equiv="Content-Language" content="en"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Parameters Interceptor</title>

  <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,400italic,600italic,700italic" rel="stylesheet" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/custom.css" rel="stylesheet">
  <link href="/highlighter/github-theme.css" rel="stylesheet">

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script type="text/javascript" src="/bootstrap/js/bootstrap.js"></script>
  <script type="text/javascript" src="/js/community.js"></script>
</head>
<body>

<a href="http://github.com/apache/struts" class="github-ribbon">
  <img style="position: absolute; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub">
</a>

<header>
  <nav>
    <div role="navigation" class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" data-toggle="collapse" data-target="#struts-menu" class="navbar-toggle">
            Menu
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/index.html" class="navbar-brand logo"><img src="/img/struts-logo.svg"></a>
        </div>
        <div id="struts-menu" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Home<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/index.html">Welcome</a></li>
                <li><a href="/downloads.html">Downloads</a></li>
                <li><a href="/announce.html">Announcements</a></li>
                <li><a href="http://www.apache.org/licenses/">License</a></li>
                <li><a href="http://apache.org/foundation/thanks.html">Thanks!</a></li>
                <li><a href="http://apache.org/foundation/sponsorship.html">Sponsorship</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Support<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/mail.html">User Mailing List</a></li>
                <li><a href="https://issues.apache.org/jira/browse/WW">Issue Tracker</a></li>
                <li><a href="/security.html">Reporting Security Issues</a></li>
                <li class="divider"></li>
                <li><a href="/maven/project-info.html">Project info</a></li>
                <li><a href="/maven/struts2-core/dependencies.html">Struts Core dependencies</a></li>
                <li><a href="/maven/struts2-plugins/modules.html">Plugin dependencies</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Documentation<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/birdseye.html">Birds Eye</a></li>
                <li><a href="/primer.html">Key Technologies</a></li>
                <li><a href="/kickstart.html">Kickstart FAQ</a></li>
                <li><a href="https://cwiki.apache.org/confluence/display/WW/Home">Wiki</a></li>
                <li class="divider"></li>
                <li><a href="/getting-started/">Getting Started</a></li>
                <li><a href="/security/">Security Guide</a></li>
                <li><a href="/docs/tutorials.html">Tutorials</a></li>
                <li><a href="/docs/faqs.html">FAQs</a></li>
                <li><a href="/docs/guides.html">Guides</a></li>
                <li class="divider"></li>
                <li><a href="/maven/struts2-core/apidocs/index.html">Struts Core API</a></li>
                <li><a href="/docs/plugins.html">Plugin APIs</a></li>
                <li><a href="/docs/tag-reference.html">Tag reference</a></li>
                <li><a href="http://cwiki.apache.org/S2PLUGINS/home.html">Plugin registry</a></li>
                <li class="divider"></li>                
                <li><a href="/core-developers/">Core Developers Guide (WIP)</a></li>
                <li><a href="/plugins/">Plugins (WIP)</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                Contributing<b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                <li><a href="/youatstruts.html">You at Struts</a></li>
                <li><a href="/helping.html">How to Help FAQ</a></li>
                <li><a href="/dev-mail.html">Development Lists</a></li>
                <li class="divider"></li>
                <li><a href="/submitting-patches.html">Submitting patches</a></li>
                <li><a href="/builds.html">Source Code</a></li>
                <li><a href="/coding-standards.html">Coding standards</a></li>
                <li class="divider"></li>
                <li><a href="/releases.html">Release Guidelines</a></li>
                <li><a href="/bylaws.html">PMC Charter</a></li>
                <li><a href="/volunteers.html">Volunteers</a></li>
                <li><a href="https://git-wip-us.apache.org/repos/asf?p=struts.git">Source Repository</a></li>
              </ul>
            </li>
            <li class="apache"><a href="http://www.apache.org/"><img src="/img/apache.png"></a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
</header>


<article class="container">
  <section class="col-md-12">
    <a href="index.html" title="back to Core Developers Guide"><< back to Core Developers Guide</a>
    <a class="edit-on-gh" href="https://github.com/apache/struts-site/edit/master/source/core-developers/parameters-interceptor.md" title="Edit this page on GitHub">Edit on GitHub</a>
    <h1 id="parameters-interceptor">Parameters Interceptor</h1>

<p>This interceptor sets all parameters on the value stack.</p>

<p>This interceptor gets all parameters from {@link ActionContext#getParameters()} and sets them on the value stack by calling</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ValueStack#setValue(String, Object)
</code></pre>
</div>
<p>, typically resulting in the values submitted in a form request being applied to an action in the value stack. Note that the parameter map must contain a String key and often containers a String[] for the value.</p>

<p>The interceptor takes one parameter named ‘ordered’. When set to true action properties are guaranteed to be set top-down which means that top action’s properties are set first. Then it’s subcomponents properties are set. The reason for this order is to enable a ‘factory’ pattern. For example, let’s assume that one has an action that contains a property named</p>

<div class="highlighter-rouge"><pre class="highlight"><code>modelClass
</code></pre>
</div>
<p> that allows to choose what is the underlying implementation of model. By assuring that</p>

<div class="highlighter-rouge"><pre class="highlight"><code>modelClass
</code></pre>
</div>
<p> property is set before any model properties are set, it’s possible to choose model implementation during</p>

<div class="highlighter-rouge"><pre class="highlight"><code>action.setModelClass()
</code></pre>
</div>
<p> call. Similarly it’s possible to use</p>

<div class="highlighter-rouge"><pre class="highlight"><code>action.setPrimaryKey() 
</code></pre>
</div>
<p>property set call to actually load the model class from persistent storage. Without any assumption on parameter order you have to use patterns like <em>Preparable Interface</em> .</p>

<p>Because parameter names are effectively OGNL statements, it is important that security be taken in to account. This interceptor will not apply any values in the parameters map if the expression contains an assignment (=), multiple expressions (,), or references any objects in the context (#). This is all done in the</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#acceptableName(String)
</code></pre>
</div>
<p> method. In addition to this method, if the action being invoked implements the </p>

<div class="highlighter-rouge"><pre class="highlight"><code>ParameterNameAware
</code></pre>
</div>
<p> interface, the action will be consulted to determine if the parameter should be set.
In addition to these restrictions, a flag (</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ReflectionContextState#DENY_METHOD_EXECUTION
</code></pre>
</div>
<p> ) is set such that no methods are allowed to be invoked. That means that any expression such as</p>

<div class="highlighter-rouge"><pre class="highlight"><code>person.doSomething()
</code></pre>
</div>
<p> or </p>

<div class="highlighter-rouge"><pre class="highlight"><code>person.getName()
</code></pre>
</div>
<p> will be explicitly forbidden. This is needed to make sure that your application is not exposed to attacks by malicious users.</p>

<p>While this interceptor is being invoked, a flag (</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ReflectionContextState#CREATE_NULL_OBJECTS
</code></pre>
</div>
<p> ) is turned on to ensure that any null reference is automatically created - if possible. See the type conversion documentation and the</p>

<div class="highlighter-rouge"><pre class="highlight"><code>InstantiatingNullHandler
</code></pre>
</div>
<p> javadocs for more information.</p>

<p>Finally, a third flag (</p>

<div class="highlighter-rouge"><pre class="highlight"><code>XWorkConverter#REPORT_CONVERSION_ERRORS
</code></pre>
</div>
<p> ) is set that indicates any errors when converting the the values to their final data type (String[] -&gt; int) an unrecoverable error occurred. With this flag set, the type conversion errors will be reported in the action context. See the type conversion documentation and the</p>

<div class="highlighter-rouge"><pre class="highlight"><code>XWorkConverter
</code></pre>
</div>
<p> javadocs for more information.</p>

<p>If you are looking for detailed logging information about your parameters, turn on</p>

<div class="highlighter-rouge"><pre class="highlight"><code>DEBUG
</code></pre>
</div>
<p> level logging for this interceptor. A detailed log of all the parameter keys and values will be reported.</p>

<p>Since XWork 2.0.2, this interceptor extends MethodFilterInterceptor, therefore being able to deal with excludeMethods / includeMethods parameters. See <a href="default-workflow-interceptor.html">Default Workflow Interceptor</a> for documentation and examples on how to use this feature.</p>

<table>
  <tbody>
    <tr>
    </tr>
  </tbody>
</table>

<p>For more information on ways to restrict the parameter names allowed, see the</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ParameterNameAware
</code></pre>
</div>
<p> javadocs.</p>

<p>#####Parameters#####</p>

<ul>
  <li></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>ordered
</code></pre>
</div>
<p> - set to true if you want the top-down property setter behaviour</p>

<ul>
  <li></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>acceptParamNames
</code></pre>
</div>
<p> - a comma delimited list of regular expressions to describe a whitelist of accepted parameter names. Don’t change the default unless you know what you are doing in terms of security implications</p>

<ul>
  <li></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>excludeParams
</code></pre>
</div>
<p> - a comma delimited list of regular expressions to describe a blacklist of not allowed parameter names</p>

<ul>
  <li></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>paramNameMaxLength
</code></pre>
</div>
<p> - the maximum length of parameter names; parameters with longer names will be ignored; the default is 100 characters</p>

<p>#####Excluding parameters#####</p>

<p>This interceptor can be forced to ignore parameters, by setting its <em>excludeParams</em>  attribute. This attribute accepts a comma separated list of regular expressions. When any of these expressions match the name of a parameter, such parameter will be ignored by the interceptor. Interceptor stacks defined by Struts already exclude some parameters:</p>

<p><strong>Default List of Parameters Excluded</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>dojo\..*,^struts\..*,^session\..*,^request\..*,^application\..*,^servlet(Request|Response)\..*,parameters\...*

</code></pre>
</div>

<p>Below is an example of adding a parameter named submit to the list of parameters that should be excluded.</p>

<p><strong>Setup Interceptor Stack To Exclude submit Parameter</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;interceptors&gt;
  &lt;interceptor-stack name="appDefault"&gt;
    &lt;interceptor-ref name="defaultStack"&gt;
       &lt;param name="exception.logEnabled"&gt;true&lt;/param&gt;
       &lt;param name="exception.logLevel"&gt;ERROR&lt;/param&gt;
       &lt;param name="params.excludeParams"&gt;dojo\..*,^struts\..*,^session\..*,^request\..*,^application\..*,^servlet(Request|Response)\..*,parameters\...*,submit&lt;/param&gt;
    &lt;/interceptor-ref&gt;
  &lt;/interceptor-stack&gt;
&lt;/interceptors&gt;
		
&lt;default-interceptor-ref name="appDefault" /&gt;

</code></pre>
</div>

<p>#####Extending the Interceptor#####</p>

<p>The best way to add behavior to this interceptor is to utilize the</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ParameterNameAware
</code></pre>
</div>
<p> interface in your actions. However, if you wish to apply a global rule that isn’t implemented in your action, then you could extend this interceptor and override the</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#acceptableName(String)
</code></pre>
</div>
<p> method.</p>

<blockquote>

</blockquote>

<blockquote>

</blockquote>

<blockquote>
  <p>Using ParameterNameAware could be dangerous as ParameterNameAware#acceptableParameterName(String) takes precedence over ParametersInterceptor which means if ParametersInterceptor excluded given parameter name you can accept it with ParameterNameAware#acceptableParameterName(String).</p>
</blockquote>

<blockquote>

</blockquote>

<blockquote>

</blockquote>

<blockquote>
  <p>The best idea is to define very tight restrictions with ParametersInterceptor and relax them per action with ParameterNameAware#acceptableParameterName(String)</p>
</blockquote>

<blockquote>

</blockquote>

<p>#####Warning on missing parameters#####</p>

<p>When there is no setter for given parameter name, a warning message like below will be logged in devMode:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SEVERE: Developer Notification (set struts.devMode to false to disable this message):
Unexpected Exception caught setting 'search' on 'class demo.ItemSearchAction: Error setting expression 'search' with value ['search', ]
Error setting expression 'search' with value ['search', ] - [unknown location]
	at com.opensymphony.xwork2.ognl.OgnlValueStack.handleRuntimeException(OgnlValueStack.java:201)
	at com.opensymphony.xwork2.ognl.OgnlValueStack.setValue(OgnlValueStack.java:178)
	at com.opensymphony.xwork2.ognl.OgnlValueStack.setParameter(OgnlValueStack.java:152)

</code></pre>
</div>

<p>Thus is expected behaviour to allow developer to spot missing setter or typo in either parameter name or setter.</p>

<p>#####Examples#####</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;action name="someAction" class="com.examples.SomeAction"&gt;
  &lt;interceptor-ref name="params"/&gt;
  &lt;result name="success"&gt;good_result.ftl&lt;/result&gt;
&lt;/action&gt;
</code></pre>
</div>

  </section>
</article>


<footer class="container">
  <div class="col-md-12">
    Copyright &copy; 2000-2016 <a href="http://www.apache.org/">The Apache Software Foundation </a>.
    All Rights Reserved.
  </div>
  <div class="col-md-12">
    Apache Struts, Struts, Apache, the Apache feather logo, and the Apache Struts project logos are
    trademarks of The Apache Software Foundation.
  </div>
  <div class="col-md-12">Logo and website design donated by <a href="https://softwaremill.com/">SoftwareMill</a>.</div>
</footer>

<script>!function (d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (!d.getElementById(id)) {
    js = d.createElement(s);
    js.id = id;
    js.src = "//platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);
  }
}(document, "script", "twitter-wjs");</script>
<script src="https://apis.google.com/js/platform.js" async="async" defer="defer"></script>

<div id="fb-root"></div>

<script>(function (d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s);
  js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


<script>
$(function() {
  return $("h2, h3, h4, h5, h6").each(function(i, el) {
    var $el, id;
    $el = $(el);
    id = $el.attr('id');
    if (id) {
      $el.removeAttr('id');
      return $el.before($("<a />").addClass('anchor').attr('name', id));
    }
  });
});
</script>

</body>
</html>
